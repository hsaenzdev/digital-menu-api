model Order {
  id          String @id @default(cuid())
  orderNumber Int    @unique @default(autoincrement())

  // Customer relationship - required for all orders
  customerId String
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)

  // Location relationship - required for all orders
  customerLocationId String
  customerLocation   CustomerLocation @relation(fields: [customerLocationId], references: [id], onDelete: Restrict)

  total    Float
  subtotal Float
  tax      Float @default(0)
  tip      Float @default(0)

  // Payment fields
  paymentMethod       String    @default("cash") // 'cash' | 'bank_transfer'
  paymentStatus       String    @default("pending") // 'pending' | 'confirmed' | 'failed'
  transferReference   String?   // Customer's reference/transaction number
  transferConfirmedAt DateTime?
  transferConfirmedBy String?   // Staff member ID who confirmed

  status    String   @default("pending") // pending, pending_payment, confirmed, preparing, ready, delivered, cancelled
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  items OrderItem[]

  @@index([customerId])
  @@index([customerLocationId])
  @@map("orders")
}

model OrderItem {
  id      String @id @default(cuid())
  orderId String
  itemId  String

  // Item details at time of order (for historical accuracy)
  itemName     String
  itemPrice    Float
  quantity     Int
  specialNotes String?

  // Calculated totals
  unitPrice  Float
  totalPrice Float

  // Selected modifiers (stored as JSON)
  selectedModifiers String? // JSON: [{"groupId": "...", "modifierId": "...", "name": "Extra Cheese", "price": 2.00}]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  order Order @relation(fields: [orderId], references: [id], onDelete: Cascade)

  @@map("order_items")
}
